<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<style>
body { font-family: Arial; background:#eef1f5; margin:0; padding:0; }
.navbar { background:#0a3d62; color:#fff; padding:15px; display:flex; justify-content:space-between; }
.container { width:90%; margin:20px auto; background:#fff; padding:20px; border-radius:10px; }
.dashboard { display:flex; justify-content: space-between; margin-bottom:20px; }
.card { background:#1e3799; color:#fff; padding:20px; border-radius:10px; flex:1; margin-right:10px; text-align:center; }
.card:last-child { margin-right:0; }
table { width:100%; border-collapse: collapse; margin-top:15px; }
table th, table td { padding:12px; border-bottom:1px solid #ccc; }
table th { background:#0a3d62; color:#fff; }
button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
.btn-delete { background:#dc3545; color:#fff; }
.btn-logout { background:#f44336; color:#fff; }
#searchBox { margin-bottom:10px; width:300px; padding:5px; }
.activity-log { margin-top:30px; }
.btn-profile {
    padding: 8px 12px;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    background: #1e90ff;
    color: white;
    margin-right: 8px;
}

.btn-profile:hover {
    background: #0b70d0;
}
/* Dark mode styles */
body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
}

body.dark-mode .container {
    background-color: #1e1e1e;
    color: #e0e0e0;
}

body.dark-mode table th {
    background-color: #333;
    color: #fff;
}

body.dark-mode table td {
    border-bottom: 1px solid #555;
}

body.dark-mode .navbar {
    background-color: #1a1a1a;
    color: #fff;
}

body.dark-mode input,
body.dark-mode select,
body.dark-mode textarea {
    background-color: #2b2b2b;
    color: #e0e0e0;
    border: 1px solid #555;
}

body.dark-mode button {
    color: white;
}

body.dark-mode .btn-profile { background-color: #0d6efd; }
body.dark-mode .btn-profile:hover { background-color: #0a58ca; }
body.dark-mode .btn-logout { background-color: #e63946; }
body.dark-mode .btn-logout:hover { background-color: #cc2f3b; }
body.dark-mode .btn-add { background-color: #28a745; }
body.dark-mode .btn-add:hover { background-color: #218838; }

.btn-settings {
    padding: 8px 12px;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    background: #0A3d62;
    color: white;
    margin-right: 8px;
}

.btn-settings:hover {
    background: #5a6268;
}

</style>
</head>
<body>

<div class="navbar">
    <h2>Admin Dashboard</h2>
    <div>
        <button class="btn-settings" onclick="openSettings()">‚öôÔ∏è Settings</button>
        <button class="btn-toggle" id="darkModeToggle">üåô Dark Mode</button>
        <button class="btn-profile" onclick="window.location.href='profile.html'">Profile</button>
        <button class="btn-logout" onclick="logout()">Logout</button>
    </div>
</div>



<div class="container">
    <!-- Dashboard Cards -->
    <div class="dashboard">
        <div class="card" id="totalUsers">Users: 0</div>
        <div class="card" id="totalRecords">Records: 0</div>
        <div class="card" id="totalTypes">Types: 0</div>
    </div>

    <!-- Records Table -->
    <h3>All User Counseling Records</h3>
    <input type="text" id="searchBox" placeholder="Search records...">
    <table>
        <thead>
            <tr>
                <th>Student</th>
                <th>Type</th>
                <th>Description</th>
                <th>Date</th>
                <th>Created By</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="adminRecordTable"></tbody>
    </table>

    <!-- Activity Logs -->
    <div class="activity-log">
        <h3>Activity Logs</h3>
        <ul id="activityLogs"></ul>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const currentEmail = localStorage.getItem("currentUser");
    if(!currentEmail) window.location.href="login.html";

    const currentUser = JSON.parse(localStorage.getItem(currentEmail));
    if(!currentUser || currentUser.role !== "admin") window.location.href="login.html";

    renderAdminRecords();
    updateDashboard();

    const searchInput = document.getElementById("searchBox");
    searchInput.addEventListener("input", function() {
        renderAdminRecords(this.value);
    });
});

// Render all user records with optional search
function renderAdminRecords(filterText = "") {
    const table = document.getElementById("adminRecordTable");
    table.innerHTML = "";

    const records = JSON.parse(localStorage.getItem("records") || "[]");

    records.forEach((rec, index) => {
        const combinedText = `${rec.student} ${rec.type} ${rec.description} ${rec.createdBy}`.toLowerCase();
        if(filterText && !combinedText.includes(filterText.toLowerCase())) return;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${rec.student}</td>
            <td>${rec.type}</td>
            <td>${rec.description}</td>
            <td>${rec.date}</td>
            <td>${rec.createdBy}</td>
            <td><button onclick="deleteAdminRecord(${index})" class="btn-delete">Delete</button></td>
        `;
        table.appendChild(row);
    });
}

// Delete a record and log activity
function deleteAdminRecord(index) {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    if(index < 0 || index >= records.length) return;

    if(confirm("Are you sure you want to delete this record?")){
        const rec = records[index];
        records.splice(index,1);
        localStorage.setItem("records", JSON.stringify(records));
        addActivityLog(`Deleted record of ${rec.student} by admin`);
        renderAdminRecords();
        updateDashboard();
    }
}

// Activity log functions
function addActivityLog(message){
    const logs = JSON.parse(localStorage.getItem("activityLogs") || "[]");
    const timestamp = new Date().toLocaleString();
    logs.push({message, timestamp});
    localStorage.setItem("activityLogs", JSON.stringify(logs));
    renderActivityLogs();
}

function renderActivityLogs(){
    const ul = document.getElementById("activityLogs");
    ul.innerHTML = "";
    const logs = JSON.parse(localStorage.getItem("activityLogs") || "[]");
    logs.slice().reverse().forEach(log=>{
        const li = document.createElement("li");
        li.textContent = `[${log.timestamp}] ${log.message}`;
        ul.appendChild(li);
    });
}
// DARK MODE TOGGLE
const darkModeToggle = document.getElementById("darkModeToggle");

function setDarkMode(enabled) {
    if (enabled) {
        document.body.classList.add("dark-mode");
        localStorage.setItem("darkMode", "enabled");
        darkModeToggle.textContent = "‚òÄÔ∏è Light Mode";
    } else {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("darkMode", "disabled");
        darkModeToggle.textContent = "üåô Dark Mode";
    }
}

// Initialize dark mode from localStorage
if (localStorage.getItem("darkMode") === "enabled") {
    setDarkMode(true);
} else {
    setDarkMode(false);
}

// Toggle dark mode on button click
darkModeToggle.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark-mode");
    setDarkMode(!isDark);
});

// Dashboard summary
function updateDashboard(){
    const users = JSON.parse(localStorage.getItem("users") || "[]"); // optional if you track all users
    const records = JSON.parse(localStorage.getItem("records") || "[]");
    const types = [...new Set(records.map(r=>r.type))];

    document.getElementById("totalUsers").textContent = `Users: ${users.length}`;
    document.getElementById("totalRecords").textContent = `Records: ${records.length}`;
    document.getElementById("totalTypes").textContent = `Types: ${types.length}`;
}
function openSettings() {
    const email = localStorage.getItem("currentUser");
    const user = JSON.parse(localStorage.getItem(email));

    document.getElementById("settingsName").value = user.name;
    document.getElementById("settingsEmail").value = user.email;
    document.getElementById("settingsPassword").value = "";
    document.getElementById("settingsConfirmPassword").value = "";
    document.getElementById("settingsDarkMode").value = localStorage.getItem("darkMode") || "disabled";

    document.getElementById("settingsModal").style.display = "flex";
}

function closeSettings() {
    document.getElementById("settingsModal").style.display = "none";
}

function saveSettings() {
    const email = localStorage.getItem("currentUser");
    const user = JSON.parse(localStorage.getItem(email));

    const newName = document.getElementById("settingsName").value.trim();
    const newEmail = document.getElementById("settingsEmail").value.trim();
    const newPassword = document.getElementById("settingsPassword").value;
    const confirmPassword = document.getElementById("settingsConfirmPassword").value;
    const darkMode = document.getElementById("settingsDarkMode").value;

    if(newName === "" || newEmail === "") {
        alert("Name and Email cannot be empty!");
        return;
    }

    if(newPassword !== confirmPassword) {
        alert("Passwords do not match!");
        return;
    }

    // Update user info
    user.name = newName;
    user.email = newEmail;
    if(newPassword) user.password = newPassword;

    localStorage.setItem(newEmail, JSON.stringify(user));
    if(email !== newEmail) localStorage.removeItem(email);
    localStorage.setItem("currentUser", newEmail);

    // Update dark mode
    localStorage.setItem("darkMode", darkMode);
    if(darkMode === "enabled") document.body.classList.add("dark-mode");
    else document.body.classList.remove("dark-mode");

    alert("Settings updated!");
    closeSettings();
}


// Logout
function logout(){
    localStorage.removeItem("currentUser");
    window.location.href="login.html";
}

// Initial render logs
renderActivityLogs();
</script>
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <button class="btn-close" onclick="closeSettings()">X</button>
        <h3>Settings</h3>

        <label>Change Name</label>
        <input type="text" id="settingsName">

        <label>Change Email</label>
        <input type="email" id="settingsEmail">

        <label>Change Password</label>
        <input type="password" id="settingsPassword">

        <label>Confirm Password</label>
        <input type="password" id="settingsConfirmPassword">

        <label>Dark Mode</label>
        <select id="settingsDarkMode">
            <option value="enabled">Enabled</option>
            <option value="disabled">Disabled</option>
        </select>

        <button class="btn-add" onclick="saveSettings()">Save Settings</button>
    </div>
</div>

</body>
</html>